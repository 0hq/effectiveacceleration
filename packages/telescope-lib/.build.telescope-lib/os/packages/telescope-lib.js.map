{"version":3,"file":"/packages/telescope-lib.js","sources":["telescope-lib/lib/lib.js","telescope-lib/lib/deep.js","telescope-lib/lib/deep_extend.js","telescope-lib/lib/autolink.js","telescope-lib/lib/permissions.js"],"names":[],"mappings":";;;;;;;;AAAA,0B;AACA,qD;AACA,C;;AAEA,6C;AACA,4C;;AAEA,sH;AACA,oC;;AAEA,gI;AACA,2C;;AAEA,oG;AACA,6B;;AAEA,2E;AACA,0B;;AAEA,iC;AACA,qB;AACA,G;;AAEA,E;;AAEA,kD;AACA,oD;AACA,kC;AACA,Q;AACA,mE;AACA,G;AACA,E;;AAEA,8B;AACA,sF;AACA,C;;AAEA,8B;AACA,4C;AACA,C;;AAEA,8B;AACA,2F;AACA,C;;AAEA,mC;AACA,sC;AACA,kC;AACA,mC;AACA,W;AACA,E;;AAEA,gC;AACA,0D;AACA,C;;;;;;;;;;;;;;;;;;ACtDA,2C;;AAEA,S;AACA,C;AACA,2C;AACA,oC;AACA,C;AACA,4F;AACA,a;AACA,c;AACA,wB;AACA,C;AACA,qB;AACA,+B;AACA,C;AACA,iB;AACA,U;AACA,C;AACA,qB;AACA,wB;AACA,8D;AACA,O;AACA,C;AACA,2B;AACA,C;AACA,mB;AACA,C;AACA,qB;AACA,Y;AACA,yD;AACA,mC;AACA,K;AACA,C;AACA,iB;AACA,G;AACA,C;AACA,G;AACA,C;AACA,S;AACA,E;AACA,c;AACA,S;AACA,W;AACA,a;AACA,6B;AACA,U;AACA,Q;AACA,M;AACA,K;AACA,E;AACA,iB;AACA,oC;AACA,E;AACA,iB;AACA,uC;AACA,E;AACA,yC;;;AAGA,S;AACA,kC;AACA,uE;AACA,G;AACA,G;;;AAGA,S;AACA,C;AACA,6E;AACA,0B;AACA,0B;AACA,uG;AACA,G;AACA,C;AACA,G;;;;;;;;;;;;;;;;;;AC1EA,sF;AACA,0B;AACA,gF;AACA,Y;AACA,gC;AACA,mB;AACA,2C;AACA,+C;AACA,kC;AACA,oC;AACA,mC;AACA,wC;AACA,oB;AACA,sC;AACA,oC;AACA,oC;AACA,wC;AACA,kC;AACA,gC;AACA,oC;AACA,mC;AACA,Q;AACA,gB;AACA,oC;AACA,iD;AACA,U;AACA,iC;AACA,wB;AACA,8C;AACA,U;AACA,kC;AACA,kD;AACA,U;AACA,mC;AACA,0D;AACA,U;AACA,8B;AACA,wF;AACA,U;AACA,uC;AACA,sE;AACA,yB;AACA,W;AACA,e;AACA,kI;AACA,2B;AACA,a;AACA,uB;AACA,yB;AACA,W;AACA,kB;AACA,6B;AACA,4D;AACA,S;AACA,Q;AACA,sC;AACA,oB;AACA,kC;AACA,Y;AACA,K;AACA,mE;AACA,kB;AACA,K;AACA,uB;AACA,oB;AACA,U;AACA,K;AACA,8B;AACA,6C;AACA,+B;AACA,6B;AACA,+B;AACA,gC;AACA,qB;AACA,W;AACA,qG;AACA,8B;AACA,kC;AACA,4D;AACA,oB;AACA,kE;AACA,a;AACA,iC;AACA,yD;AACA,0C;AACA,gC;AACA,W;AACA,S;AACA,O;AACA,K;AACA,kB;AACA,I;;;;;;;;;;;;;;;;;;AC3FA,2C;AACA,0hB;;;;;;;;;;;;;;;;;;;ACDA,S;;AAEA,c;;AAEA,iD;AACA,kF;AACA,G;AACA,8D;AACA,0B;AACA,yG;;AAEA,6C;;AAEA,wB;AACA,oD;AACA,oE;AACA,K;;AAEA,mD;AACA,iD;AACA,kB;AACA,U;AACA,mB;AACA,K;;AAEA,G;AACA,c;AACA,E;AACA,6C;AACA,6E;AACA,6C;AACA,gE;AACA,+E;AACA,G;AACA,c;AACA,E;AACA,uC;AACA,gE;;AAEA,2E;AACA,E;AACA,Y;AACA,8C;AACA,6B;AACA,gB;AACA,+C;AACA,yB;AACA,kB;AACA,Y;AACA,+C;AACA,K;AACA,U;AACA,gB;AACA,G;AACA,E;AACA,6C;AACA,0C;AACA,oC;AACA,E;AACA,0C;AACA,oC;AACA,E;AACA,gD;AACA,0C;AACA,uC;AACA,E;AACA,qD;AACA,oC;AACA,E;AACA,+C;AACA,0C;AACA,sC;AACA,E;AACA,uD;AACA,oC;AACA,E;AACA,iD;AACA,0C;AACA,wC;AACA,E;AACA,6C;AACA,gE;AACA,E;AACA,sB;AACA,6C;AACA,6B;AACA,gB;AACA,sC;AACA,6C;AACA,S;AACA,gB;AACA,G;AACA,E;AACA,sC;AACA,0C;AACA,6B;AACA,E;AACA,sC;AACA,sC;AACA,E;AACA,4B;AACA,0C;AACA,E","sourcesContent":["getSiteUrl = function () {\n  return getSetting('siteUrl', Meteor.absoluteUrl());\n}\n\ngetSetting = function(setting, defaultValue){\n  var settings = Settings.find().fetch()[0];\n\n  if (Meteor.isServer && Meteor.settings && !!Meteor.settings[setting]) { // if on the server, look in Meteor.settings\n    return Meteor.settings[setting];\n\n  } else if (Meteor.settings && Meteor.settings.public && !!Meteor.settings.public[setting]) { // look in Meteor.settings.public\n    return Meteor.settings.public[setting];\n\n  } else if(settings && (typeof settings[setting] !== 'undefined')) { // look in Settings collection\n    return settings[setting];\n\n  } else if (typeof defaultValue !== 'undefined') { // fallback to default \n    return  defaultValue; \n\n  } else { // or return undefined\n    return undefined;\n  }\n\n};\n\ngetThemeSetting = function(setting, defaultValue){\n  if(typeof themeSettings[setting] !== 'undefined'){\n    return themeSettings[setting];\n  }else{\n    return typeof defaultValue === 'undefined' ? '' : defaultValue;\n  }\n};\n\ncamelToDash = function (str) {\n  return str.replace(/\\W+/g, '-').replace(/([a-z\\d])([A-Z])/g, '$1-$2').toLowerCase();\n}\n\ncamelCaseify = function(str) {\n  return dashToCamel(str.replace(' ', '-'));\n}\n\ndashToCamel = function (str) {\n  return str.replace(/(\\-[a-z])/g, function($1){return $1.toUpperCase().replace('-','');});\n}\n\ntrimWords = function(s, numWords) {\n  expString = s.split(/\\s+/,numWords);\n  if(expString.length >= numWords)\n    return expString.join(\" \")+\"â€¦\";\n  return s;\n};\n\ncapitalise = function (string) {\n  return string.charAt(0).toUpperCase() + string.slice(1);\n}","// see https://gist.github.com/furf/3208381\n\n_.mixin({\n \n  // Get/set the value of a nested property\n  deep: function (obj, key, value) {\n \n    var keys = key.replace(/\\[([\"']?)([^\\1]+?)\\1?\\]/g, '.$2').replace(/^\\./, '').split('.'),\n        root,\n        i = 0,\n        n = keys.length;\n \n    // Set deep value\n    if (arguments.length > 2) {\n \n      root = obj;\n      n--;\n \n      while (i < n) {\n        key = keys[i++];\n        obj = obj[key] = _.isObject(obj[key]) ? obj[key] : {};\n      }\n \n      obj[keys[i]] = value;\n \n      value = root;\n \n    // Get deep value\n    } else {\n      while ((obj = obj[keys[i++]]) != null && i < n) {};\n      value = i < n ? void 0 : obj;\n    }\n \n    return value;\n  }\n \n});\n \n// Usage:\n//\n// var obj = {\n//   a: {\n//     b: {\n//       c: {\n//         d: ['e', 'f', 'g']\n//       }\n//     }\n//   }\n// };\n//\n// Get deep value\n// _.deep(obj, 'a.b.c.d[2]'); // 'g'\n//\n// Set deep value\n// _.deep(obj, 'a.b.c.d[2]', 'george');\n//\n// _.deep(obj, 'a.b.c.d[2]'); // 'george'\n\n\n_.mixin({\n  pluckDeep: function (obj, key) {\n    return _.map(obj, function (value) { return _.deep(value, key); });\n  }\n});\n\n\n_.mixin({\n \n // Return a copy of an object containing all but the blacklisted properties.\n  unpick: function (obj) {\n    obj || (obj = {});    \n    return _.pick(obj, _.difference(_.keys(obj), _.flatten(Array.prototype.slice.call(arguments, 1))));\n  }\n \n});","// see: http://stackoverflow.com/questions/9399365/deep-extend-like-jquerys-for-nodejs\ndeepExtend = function () {\n  var options, name, src, copy, copyIsArray, clone, target = arguments[0] || {},\n      i = 1,\n      length = arguments.length,\n      deep = false,\n      toString = Object.prototype.toString,\n      hasOwn = Object.prototype.hasOwnProperty,\n      push = Array.prototype.push,\n      slice = Array.prototype.slice,\n      trim = String.prototype.trim,\n      indexOf = Array.prototype.indexOf,\n      class2type = {\n        \"[object Boolean]\": \"boolean\",\n        \"[object Number]\": \"number\",\n        \"[object String]\": \"string\",\n        \"[object Function]\": \"function\",\n        \"[object Array]\": \"array\",\n        \"[object Date]\": \"date\",\n        \"[object RegExp]\": \"regexp\",\n        \"[object Object]\": \"object\"\n      },\n      jQuery = {\n        isFunction: function (obj) {\n          return jQuery.type(obj) === \"function\";\n        },\n        isArray: Array.isArray ||\n        function (obj) {\n          return jQuery.type(obj) === \"array\";\n        },\n        isWindow: function (obj) {\n          return obj != null && obj == obj.window;\n        },\n        isNumeric: function (obj) {\n          return !isNaN(parseFloat(obj)) && isFinite(obj);\n        },\n        type: function (obj) {\n          return obj == null ? String(obj) : class2type[toString.call(obj)] || \"object\";\n        },\n        isPlainObject: function (obj) {\n          if (!obj || jQuery.type(obj) !== \"object\" || obj.nodeType) {\n            return false;\n          }\n          try {\n            if (obj.constructor && !hasOwn.call(obj, \"constructor\") && !hasOwn.call(obj.constructor.prototype, \"isPrototypeOf\")) {\n              return false;\n            }\n          } catch (e) {\n            return false;\n          }\n          var key;\n          for (key in obj) {}\n          return key === undefined || hasOwn.call(obj, key);\n        }\n      };\n    if (typeof target === \"boolean\") {\n      deep = target;\n      target = arguments[1] || {};\n      i = 2;\n    }\n    if (typeof target !== \"object\" && !jQuery.isFunction(target)) {\n      target = {};\n    }\n    if (length === i) {\n      target = this;\n      --i;\n    }\n    for (i; i < length; i++) {\n      if ((options = arguments[i]) != null) {\n        for (name in options) {\n          src = target[name];\n          copy = options[name];\n          if (target === copy) {\n            continue;\n          }\n          if (deep && copy && (jQuery.isPlainObject(copy) || (copyIsArray = jQuery.isArray(copy)))) {\n            if (copyIsArray) {\n              copyIsArray = false;\n              clone = src && jQuery.isArray(src) ? src : [];\n            } else {\n              clone = src && jQuery.isPlainObject(src) ? src : {};\n            }\n            // WARNING: RECURSION\n            target[name] = deepExtend(deep, clone, copy);\n          } else if (copy !== undefined) {\n            target[name] = copy;\n          }\n        }\n      }\n    }\n    return target;\n  };","//https://github.com/bryanwoods/autolink-js\n(function(){var a,b=[].slice;a=function(){var j,i,d,f,e,c,g,h;c=1<=arguments.length?b.call(arguments,0):[];g=/(^|\\s)(\\b(https?):\\/\\/[\\-A-Z0-9+&@#\\/%?=~_|!:,.;]*[\\-A-Z0-9+&@#\\/%=~_|]\\b)/ig;if(c.length>0){e=c[0];i=e.callback;if((i!=null)&&typeof i===\"function\"){j=i;delete e.callback;}f=\"\";for(d in e){h=e[d];f+=\" \"+d+\"='\"+h+\"'\";}return this.replace(g,function(l,o,k){var n,m;m=j&&j(k);n=m||(\"<a href='\"+k+\"'\"+f+\">\"+k+\"</a>\");return\"\"+o+n;});}else{return this.replace(g,\"$1<a href='$2'>$2</a>\");}};String.prototype.autoLink=a;}).call(this);\n","can = {};\n\n// Permissions\n\n// user:                Defaults to Meteor.user()\n// returnError:         If there's an error, should we return what the problem is?\n// \n// return true if all is well, false || an error string if not\ncan.view = function(user){\n  // console.log('canView', 'user:', user, 'returnError:', returnError, getSetting('requireViewInvite'));\n\n  if(getSetting('requireViewInvite', false)){\n\n    if(Meteor.isClient){\n      // on client only, default to the current user\n      var user=(typeof user === 'undefined') ? Meteor.user() : user;\n    }\n\n    if(user && (isAdmin(user) || isInvited(user))){\n      // if logged in AND either admin or invited\n      return true;\n    }else{\n      return false;\n    }\n\n  }\n  return true;\n};\ncan.viewById = function(userId, returnError){\n  // if an invite is required to view, run permission check, else return true\n  if(getSetting('requireViewInvite', false)){\n    // if user is logged in, then run canView, else return false\n    return userId ? canView(Meteor.users.findOne(userId), returnError) : false;\n  }\n  return true;\n};\ncan.post = function(user, returnError){\n  var user=(typeof user === 'undefined') ? Meteor.user() : user;\n\n  // console.log('canPost', user, action, getSetting('requirePostInvite'));\n  \n  if(!user){\n    return returnError ? \"no_account\" : false;\n  } else if (isAdmin(user)) {\n    return true;\n  } else if (getSetting('requirePostInvite')) {\n    if (user.isInvited) {\n      return true;\n    } else {\n      return returnError ? \"no_invite\" : false;\n    }\n  } else {\n    return true;\n  }\n};\ncan.postById = function(userId, returnError){\n  var user = Meteor.users.findOne(userId);\n  return canPost(user, returnError);\n};\ncan.comment = function(user, returnError){\n  return canPost(user, returnError);\n};\ncan.commentById = function(userId, returnError){\n  var user = Meteor.users.findOne(userId);\n  return canComment(user, returnError);\n};\ncan.upvote = function(user, collection, returnError){\n  return canPost(user, returnError);\n};\ncan.upvoteById = function(userId, returnError){\n  var user = Meteor.users.findOne(userId);\n  return canUpvote(user, returnError);\n};\ncan.downvote = function(user, collection, returnError){\n  return canPost(user, returnError);\n};\ncan.downvoteById = function(userId, returnError){\n  var user = Meteor.users.findOne(userId);\n  return canDownvote(user, returnError);\n};\ncan.edit = function(user, item, returnError){\n  var user=(typeof user === 'undefined') ? Meteor.user() : user;\n  \n  if (!user || !item){\n    return returnError ? \"no_rights\" : false;\n  } else if (isAdmin(user)) {\n    return true;\n  } else if (user._id!==item.userId) {\n    return returnError ? \"no_rights\" : false;\n  }else {\n    return true;\n  }\n};\ncan.editById = function(userId, item){\n  var user = Meteor.users.findOne(userId);\n  return canEdit(user, item);\n};\ncan.currentUserEdit = function(item) {\n  return canEdit(Meteor.user(), item);\n};\ncan.invite = function(user){\n  return isInvited(user) || isAdmin(user);\n};"]}